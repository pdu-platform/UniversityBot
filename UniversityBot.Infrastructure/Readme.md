## UniversityBot.Infrastructure

Инфраструктура бота



### Работа с атачментами:

​	Каждый тип атачмента реализует IConcreteAttachment. Все реализации лежат по пути Attachment/ConcreteAttachment

​	

##### Сериализация атачментов:

​		AttachmentSerializer.

​		При добавлении нового типа, необходимо добавить его в словарь для маппинга (см BuildTypeMapper). В качестве ключа необходимо указать BotAttachmentType, а в качестве значения реализацию IConcreteAttachment. 

​		(TODO можно добавить атрибут и в ручную искать реализации)



### Работа с командами и роутинг команд

Для реализации своей команды, необходимо реализовать ICommandHandler, содержит 1 метод для обработки сообщения.

К реализации команды необходимо указать один из атрибутов:

1. IgnoreCommandHandlerAttribute (если нужно игнорировать команду. как правило это внутренние команды, если реализация ICommandHandler не установит атрибут, то будет считаться ошибкой и появится ошибка. Поэтому если нужно не обрабатывать класс, то необходимо обвесить его этим атрибутом)

2. CommandHandlerAttribute (ниже описание полей атрибута) 

   2.1. Commands - текстовые название, на которые будет реагировать команда (например: "help", "/hello", при вводе этого текста в боте, будет вызван этот обработчик)

   2.2. UserFriendlyName - имя которое будет отображаться в списке команд

   2.3. Lifetime - уровень жизни с которым должен создаваться этот ICommandHandler (Singleton, Scoped, Transient)

   2.4. ShowInAllCommandList - отображать ли в общем списке команду

3. SlashCommandHandlerAttribute - то же самое что и CommandHandlerAttribute  только к строке Commands вначале добавляется строковое значение "/"



Реализации команд лежат в Command/CommandHandlers



Всю информацию из классов команд вытягивает CommandHandlerMetadataStore. Ищет реализации и обрабатывает атрибуты.

А роутер CommandRouter получает CommandHandlerMetadataStore с описанием всех команд и когда в него приходит запрос, на основе полученных метаданных он переправляет запрос в нужный обработчик

